\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{SPL-packages}[2013/01/31 Common packages, commands, etc for SPL styles]
\typeout{Document Style `SPL-packages.sty' <2018/07/15>}
\typeout{Rev. 1.0.5}

% Revision history
% 1.0.2 (2013/01/31) - replaced amsfonts with mathdesign, fourier ornaments now working
% 1.0.3 (2014/01/13) - added up-to-date packages and good practices section
% 1.0.4 (2015/01/14) - big clean-up, split packages up into small groups, see SPL-code.sty and SPL-math.sty;
%                      used xparse (LaTeX3) for declaring signed quote environment;
%                      gave options for using XeLaTeX as a backend driver, deprecated DVI->PDF route;
%                      added checks for good practice
% 1.0.5 (2015/01/14) - Extracted shorthand commands into SPL-shorthand
% TO DO 
%- rework end rules according to stack overflow example
%- use mdframed instead of framed, can also replace shabox with it
%- look up missing explanation for listed packages
%- fix copyright symbol?
%- post problem with adforn using a MWE on tex exchange
%- change all declarations to xparse format ?? see comments on xparse on tex exchange - may be worth eliminating?

%------------------------------------------------------------------------------
%                        Checks for good practice
%   (see https://tex.stackexchange.com/questions/19264/techniques-and-packages-to-keep-up-with-good-practices?rq=1)
%------------------------------------------------------------------------------
\RequirePackage[l2tabu,orthodox]{nag}% Old habits die hard. All the same, there are
                                     % commands, classes and packages which are
                                     % outdated and superseded. nag provides routines
                                     % to warn the user about the use of those.
\RequirePackage{strict}                  % prevents using LaTeX's declarations as environments (stored in local tree - not part of the MikTeX package manager)

%------------------------------------------------------------------------------
%                               General Packages
%------------------------------------------------------------------------------
%\RequirePackage[a4paper,bottom=26.6mm, textwidth=140mm, textheight=242mm, footskip=12mm]{geometry}
%\setlength{\parskip}{2ex}%
%\setlength{\parindent}{0em}%
\RequirePackage[british]{babel}
\RequirePackage{booktabs}                                   % nicer tables
\RequirePackage{multirow}
\RequirePackage{fancybox}                                   % boxed text, equations
\RequirePackage{currfile}                                   % ascertain the file's name
\RequirePackage{lastpage}                                   % determines the last page of the document
\RequirePackage{fancyhdr}                                   % headers and footers
%\RequirePackage[useregional]{datetime2}                     % date/time formats - redefines \today (datetime package is obsolete)
%\DTMlangsetup{ord=raise,monthyearsep={,\space}}         % 10th March, 2016
\RequirePackage[useregional=numeric]{datetime2}             % 10/3/2016 (datetime package is obsolete)
\RequirePackage[square,comma,numbers,sort&compress]{natbib} % citations and references - Numerical Style
\RequirePackage{bibentry}                                   % inline references (incl with natbib)
\RequirePackage[margin=12pt,font=small,labelfont=bf]{caption}% For figure captions and subfigures - see subcaption (included in caption)
\RequirePackage[margin=10pt,format=hang]{subcaption}        % better replacement for subfig
\RequirePackage{boxedminipage}                              % boxedminipage environment (incl in ltxmisc)
\RequirePackage{shadow}                                     % shadow-boxed text (incl in ltxmisc)
\RequirePackage{url}                                        % typeset and linked URLs, also used by natbib (incl in ltxmisc)
\RequirePackage{comment}                                    % allows text to be selectively included or excluded (use for exam answers)
\RequirePackage{graphicx}                                   % for including graphics
\RequirePackage[svgnames]{xcolor}                           % for defining custom colours
\graphicspath{{./Figures/}}                             % path for all graphics files
\RequirePackage{pdflscape}                                  % for landscape layout in pdf
\RequirePackage{acronym}                                    % Nomenclature listing
\RequirePackage{enumitem}                                   % for control over enumerate, itemize and description lists
\setlist{topsep=0pt, partopsep=0pt, itemsep=2pt, parsep=2pt}
\setdescription{style=nextline, itemsep=6pt, parsep=6pt}
%\RequirePackage{texnames}                                   % defines \LaTeX \BibTeX etc
\RequirePackage{soul}                                       % highlighting: hl{}; strike out: st{} etc
%\RequirePackage{refcheck}                                  % highlights missing and unreferred to citations

%------------------------------------------------------------------------------
%                      Handling XeLaTeX and PDFLaTeX Processing
%------------------------------------------------------------------------------
\RequirePackage{ifxetex}
\ifxetex
    \RequirePackage{fontspec}
    \setmainfont[Ligatures=TeX]{Bitstream Charter} % [Ligatures=TeX] required for smart quotes, m-dashes etc.
    \setmonofont[Scale=0.9]{Bera Sans Mono} % for code listings beramono is used
    \newfontfamily\quotefont[Ligatures=TeX]{Linux Libertine O} % selects Libertine for quotation marks
                                                               % more info: http://tex.stackexchange.com/questions/25249/how-do-i-use-a-particular-font-for-a-small-section-of-text-in-my-document?
\else
    % assuming pdfLaTeX driver
    \RequirePackage{lmodern}
    \RequirePackage[bitstream-charter]{mathdesign} % main font for document text + maths, supports font expansion (see microtype)
    \RequirePackage[utf8]{inputenc}
    \RequirePackage[T1]{fontenc}
    \RequirePackage[scaled]{beramono}                           % for code listings beramono is used
    \newcommand*\quotefont{\fontfamily{LinuxLibertineT-LF}} % selects Libertine as the quote font
    \RequirePackage{microtype}                                  % character protusion and font expansion for better alignment at right margin
\fi

\definecolor{darkblue}{rgb}{0,0,0.5}                % 'red', 'green' and 'blue' are predefined
\RequirePackage[pdfusetitle]{hyperref}                  % for hyperlinks in PDF (link colours defined below)
\hypersetup{
    pdfauthor={SP Levitt},                          % remove to reuse author data
    linkbordercolor={darkblue}                      % darkblue is defined above
}%


%------------------------------------------------------------------------------
%                       Definition of "signedquote" environment
% typeset signed quotations using extra-large quotation marks and a gray background
% adapted from https://tex.stackexchange.com/questions/16964/block-quote-with-big-quotation-marks
%
%------------------------------------------------------------------------------

\RequirePackage{tikz}
\RequirePackage{framed}

% Commands for the quotes
\newcommand*\quotesize{60} % if quote size changes, need a way to make shifts relative
\newcommand*{\openquote}
   {\tikz[remember picture,overlay,xshift=-4ex,yshift=-2.5ex]
   \node (OQ) {\quotefont\fontsize{\quotesize}{\quotesize}\selectfont``};\kern0pt}
\newcommand*{\closequote}
  {\tikz[remember picture,overlay,xshift=4ex,yshift=-5pt]
   \node (CQ) {\quotefont\fontsize{\quotesize}{\quotesize}\selectfont''};}

% select a colour for the shading
\colorlet{shadecolor}{GhostWhite}

% define the new environment using xparse
\RequirePackage{xparse}
\DeclareDocumentEnvironment{signedquote}{m}
{
    \begin{snugshade}
    \begin{quote}
    \openquote
}
{
    \hfill\closequote
    \vskip 1.5mm\hspace{95mm} --- \emph{#1}
    \end{quote}
    \end{snugshade}
    \vspace{6mm}
}

%------------------------------------------------------------------------------
%                      Definition of fancy end rules for documents
%
% adapted from https://tex.stackexchange.com/questions/30043/visual-separation-when-using-linerange-in-listings/
%
%------------------------------------------------------------------------------

% adforn ornaments cannot be found so settling for fourier ornaments
%\RequirePackage{adforn}
\RequirePackage{fourier-orns}

% Nice ending for sections and subsections
\def\Vhrulefill{\leavevmode\leaders\hrule height 0.7ex depth \dimexpr0.4pt-0.7ex} % vertically centered rule
\newcommand*\myhrulefill{%
%   \Vhrulefill\hfill\kern1pt} % rule for star
   \leavevmode\leaders\hrule depth-2pt height 2.6pt\hfill\kern1pt} % rule for flourishes

\newcommand\niceending[1]{%
  \begin{center}%
    \LARGE  \myhrulefill \hspace{.02cm} #1 \hspace{-0.13cm} \myhrulefill%
  \end{center}}

%\newcommand{\theend}{\vspace{5mm} {\Huge \hrulefill} \vspace{15mm} } % plain rule
\newcommand*\theend{\vspace{5mm}\niceending{\decofourleft\,\decofourright}\vspace{15mm}} % flourishes
%\newcommand*\theend{\vspace{5mm}\niceending{\starredbullet}\vspace{15mm}} % star

%------------------------------------------------------------------------------
%                      Definition of Sidebar enivronment
%------------------------------------------------------------------------------

% Sidebar experiments

% Still more experiments
% \usepackage[most]{tcolorbox}

% \newtcolorbox{marker}[1][]{enhanced,
%   before skip=2mm,after skip=3mm,
%   boxrule=0.4pt,left=12mm,right=2mm,top=1mm,bottom=1mm,
%   %colback=yellow!50,
%   colframe=yellow!20!black,
%   sharp corners,rounded corners=southeast,arc is angular,arc=3mm,
%   underlay={%
%     \path[fill=tcbcol@back!80!black] ([yshift=3mm]interior.south east)--++(-0.4,-0.1)--++(0.1,-0.2); % corner fold shade
%     \path[draw=tcbcol@frame,shorten <=-0.05mm,shorten >=-0.05mm] ([yshift=3mm]interior.south east)--++(-0.4,-0.1)--++(0.1,-0.2);
%     \path[fill=yellow!50!black,draw=none] (interior.south west) rectangle node[white]%vertical bar
%     % {\Huge\bfseries !}     
%     {\includegraphics[scale=0.3]{github-mark-3}} 
%     ([xshift=4mm]interior.north west);
%     },
%   drop fuzzy shadow,#1}



% More Experiments
% \usepackage[most]{tcolorbox}

% \newtcolorbox{marker}[1][]{enhanced,
%   before skip=2mm,after skip=3mm,
%   boxrule=0.4pt,left=5mm,right=2mm,top=1mm,bottom=1mm,
%   colback=yellow!50,
%   colframe=yellow!20!black,
%   sharp corners,rounded corners=southeast,arc is angular,arc=3mm,
%   underlay={%
%     \path[fill=tcbcol@back!80!black] ([yshift=3mm]interior.south east)--++(-0.4,-0.1)--++(0.1,-0.2);
%     \path[draw=tcbcol@frame,shorten <=-0.05mm,shorten >=-0.05mm] ([yshift=3mm]interior.south east)--++(-0.4,-0.1)--++(0.1,-0.2);
%     \path[fill=yellow!50!black,draw=none] (interior.south west) rectangle node[white]{\Huge\bfseries !} ([xshift=4mm]interior.north west);
%     },
%   drop fuzzy shadow,#1}



%\RequirePackage{wrapfig}
%\RequirePackage[most]{tcolorbox}
%\newenvironment{Sidebar}
%  {\vspace{4mm}\tcolorbox}  
%  {\endtcolorbox}

% experiment 2
\RequirePackage{tcolorbox}
\tcbuselibrary{skins}
\tcbuselibrary{breakable}

% remove tikz error: https://tex.stackexchange.com/questions/165929/semiverbatim-with-tikz-in-beamer 
 \makeatletter
 \global\let\tikz@ensure@dollar@catcode=\relax
 \makeatother


%\newenvironment{Sidebar2}
%  {\tcolorbox[breakable, enhanced,colback=yellow!10!white,boxrule=0pt,frame hidden,
%borderline west={.5mm}{12mm}{black}]}
%  {\endtcolorbox}

\newtcolorbox{Sidebar3}{
  breakable,  % can break across pages
  enhanced,   % skin
  beforeafter skip=3mm, % space above and below bounding box
  right=4mm,  % right margin of bounding box to text
  top=-2pt,    % top of bounding box to text
  bottom=2pt, % bottom of bounding box to text
  colback=white, % background colour of bounding box
  width=\textwidth,
  grow to left by=11.5mm, % modify left margin, without moving right margin
  %show bounding box,
  boxsep=4pt,
  boxrule=0pt,frame hidden,
  borderline west={.3mm}{12mm}{black}, % left bounding box margin
  fontupper=\small,
  leftupper=1.5cm, % space from left-hand box margin to text
  overlay={
    \node[anchor=north west] 
      at ([xshift=-2pt,yshift=1pt]frame.north west)
       {\includegraphics[width=0.7cm,height=0.7cm]{github-mark-2}};}
}




% experiment
\usetikzlibrary{calc}
\newcommand\verpar[2]{
    \par\vskip1ex
\noindent
\begin{tikzpicture}[
paragraph/.style = {inner sep=5pt, align = left, align = justify,
                    text width=\textwidth-\baselineskip}
                            ]
\node (p1) [paragraph] {#2};
\path ([xshift=-0.75\baselineskip] p1.south west) coordinate (p2)
            -- node (p3) [sloped,font=\sffamily] {#1} (p2 |- p1.north);
\draw[very thick] (p2) -- (p3.west) (p3.east) -- (p2 |- p1.north);
\end{tikzpicture}}


%------------------------------------------------------------------------------
% end of file - SPL-packages.sty
